<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="index.css">
    <title>Student Page</title>
</head>
<body>
    <nav>
        <ul>
             <li><a href="index.html">Home</a> </li>
             <li><a href="student_login.html">Student log in</a> </li>
             <li><a href="teacher_login.html">Teacher log in</a> </li>
         </ul>
    </nav>
    <h1>Welcome to the Student Page</h1>
    <h2>Available Courses</h2>
    <ul id="available-courses">
        <!-- Courses will be dynamically populated here -->
    </ul>
    <button onclick="enrollCourses()">Enroll in Selected Courses</button>

    <h2>Your Schedule</h2>
    <ul id="student-schedule">
        <!-- Enrolled courses will be dynamically populated here -->
    </ul>
    <button onclick="dropCourses()">Drop Selected Courses</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchCourses();
            fetchSchedule();
        });

        function fetchCourses() {
            // Sample courses for demonstration purposes
            const sampleCourses = [
                { _id: '1', name: 'Introduction to Programming' },
                { _id: '2', name: 'Data Structures' },
                { _id: '3', name: 'Web Development' },
                { _id: '4', name: 'Database Systems' },
                { _id: '5', name: 'Operating Systems' }
            ];

            const courseList = document.getElementById('available-courses');
            courseList.innerHTML = '';
            sampleCourses.forEach(course => {
                const li = document.createElement('li');
                li.innerHTML = `<input type="checkbox" id="${course._id}" name="course" value="${course._id}">
                                <label for="${course._id}">${course.name}</label>`;
                courseList.appendChild(li);
            });
        }

        function fetchSchedule() {
            fetch('/courses/schedule', {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const scheduleList = document.getElementById('student-schedule');
                scheduleList.innerHTML = '';
                data.forEach(course => {
                    const li = document.createElement('li');
                    li.innerHTML = `<input type="checkbox" id="${course._id}" name="enrolledCourse" value="${course._id}">
                                    <label for="${course._id}">${course.name}</label>`;
                    scheduleList.appendChild(li);
                });
            })
            .catch(error => {
                console.error('Error fetching schedule:', error);
                alert('Error fetching schedule: ' + error.message);
            });
        }

        function enrollCourses() {
            const selectedCourses = Array.from(document.querySelectorAll('input[name="course"]:checked')).map(input => input.value);
            selectedCourses.forEach(courseId => {
                fetch(`/courses/enroll/${courseId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    fetchSchedule();
                })
                .catch(error => {
                    console.error('Error enrolling in course:', error);
                    alert('Error enrolling in course: ' + error.message);
                });
            });
        }

        function dropCourses() {
            const selectedCourses = Array.from(document.querySelectorAll('input[name="enrolledCourse"]:checked')).map(input => input.value);
            selectedCourses.forEach(courseId => {
                fetch(`/courses/drop/${courseId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    fetchSchedule();
                })
                .catch(error => {
                    console.error('Error dropping course:', error);
                    alert('Error dropping course: ' + error.message);
                });
            });
        }
    </script>
</body>
</html>